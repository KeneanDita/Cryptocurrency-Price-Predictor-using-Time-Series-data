{% extends "base.html" %} {% block title %}Predict - Crypto Price Predictor{%
endblock %} {% block content %}
<div class="row">
  <div class="col-md-10 mx-auto">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h3>
          <i class="fas fa-calculator"></i> Predict Tomorrow's Crypto Price
        </h3>
        <p class="mb-0">
          Enter TODAY'S market data to predict TOMORROW'S closing price
        </p>
      </div>
      <div class="card-body">
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %} {% for category, message in messages %}
        <div
          class="alert alert-{{ 'danger' if category == 'danger' else 'warning' }}"
        >
          <i class="fas fa-exclamation-triangle"></i> {{ message }}
        </div>
        {% endfor %} {% endif %} {% endwith %}

        <div class="alert alert-info">
          <i class="fas fa-info-circle"></i>
          <strong>Normalization Note:</strong> All input values are
          automatically normalized to the [{{ norm_min }}, {{ norm_max }}] range
          that the model was trained on.
        </div>

        <form
          method="POST"
          action="{{ url_for('predict') }}"
          id="predictionForm"
        >
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-coins"></i> 1. Select Cryptocurrency</h5>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label for="cryptocurrency" class="form-label"
                      >Cryptocurrency:</label
                    >
                    <select
                      class="form-select form-select-lg"
                      id="cryptocurrency"
                      name="cryptocurrency"
                      required
                    >
                      <option value="">Choose a cryptocurrency...</option>
                      {% for crypto in cryptocurrencies %}
                      <option value="{{ crypto }}">
                        {{ crypto }} ({{ crypto }})
                      </option>
                      {% endfor %}
                    </select>
                    <div class="form-text">
                      Select which cryptocurrency to predict
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-info-circle"></i> How It Works</h5>
                </div>
                <div class="card-body">
                  <p>
                    <strong>Prediction Target:</strong> Tomorrow's Close Price
                  </p>
                  <p><strong>Input Required:</strong> Today's market data</p>
                  <p>
                    <strong>Normalization:</strong> Values normalized to [{{
                    norm_min }}, {{ norm_max }}]
                  </p>
                  <p class="mb-0 text-muted">
                    <small>Technical indicators auto-calculated if blank</small>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-header">
              <h5>
                <i class="fas fa-chart-line"></i> 2. Enter TODAY'S Market Data
                <span class="text-danger">*Required</span>
              </h5>
            </div>
            <div class="card-body">
              <p class="text-muted mb-3">
                Enter today's actual market prices (all in USD):
              </p>
              <div class="row">
                <div class="col-md-3 mb-3">
                  <label for="Open" class="form-label">Open Price ($):</label>
                  <input
                    type="number"
                    step="0.01"
                    class="form-control"
                    id="Open"
                    name="Open"
                    required
                    placeholder="e.g., 42000.50"
                  />
                  <div class="form-text">Today's opening price</div>
                </div>
                <div class="col-md-3 mb-3">
                  <label for="High" class="form-label">High Price ($):</label>
                  <input
                    type="number"
                    step="0.01"
                    class="form-control"
                    id="High"
                    name="High"
                    required
                    placeholder="e.g., 42500.75"
                  />
                  <div class="form-text">Today's highest price</div>
                </div>
                <div class="col-md-3 mb-3">
                  <label for="Low" class="form-label">Low Price ($):</label>
                  <input
                    type="number"
                    step="0.01"
                    class="form-control"
                    id="Low"
                    name="Low"
                    required
                    placeholder="e.g., 41800.25"
                  />
                  <div class="form-text">Today's lowest price</div>
                </div>
                <div class="col-md-3 mb-3">
                  <label for="Close" class="form-label">Close Price ($):</label>
                  <input
                    type="number"
                    step="0.01"
                    class="form-control"
                    id="Close"
                    name="Close"
                    required
                    placeholder="e.g., 42200.00"
                  />
                  <div class="form-text">Today's closing price</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-header">
              <h5>
                <i class="fas fa-calculator"></i> 3. Technical Indicators
                (Optional - Auto-calculated)
              </h5>
            </div>
            <div class="card-body">
              <p class="text-muted mb-3">
                These will be calculated automatically, but you can override
                them:
              </p>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="Daily_Return" class="form-label"
                    >Daily Return (%):</label
                  >
                  <input
                    type="number"
                    step="0.01"
                    class="form-control"
                    id="Daily_Return"
                    name="Daily_Return"
                    placeholder="Auto-calculated"
                  />
                  <div class="form-text">
                    Today's return: (Close - Open) / Open
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="RSI" class="form-label">RSI (0-100):</label>
                  <input
                    type="number"
                    step="0.1"
                    class="form-control"
                    id="RSI"
                    name="RSI"
                    min="0"
                    max="100"
                    placeholder="e.g., 65.5"
                  />
                  <div class="form-text">Relative Strength Index</div>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="Volatility_7" class="form-label"
                    >7-Day Volatility:</label
                  >
                  <input
                    type="number"
                    step="0.0001"
                    class="form-control"
                    id="Volatility_7"
                    name="Volatility_7"
                    placeholder="e.g., 0.025"
                  />
                  <div class="form-text">Recent price volatility</div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="MA_7" class="form-label">7-Day MA:</label>
                  <input
                    type="number"
                    step="0.01"
                    class="form-control"
                    id="MA_7"
                    name="MA_7"
                    placeholder="Auto-calculated"
                  />
                  <div class="form-text">7-day moving average</div>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="MACD" class="form-label">MACD:</label>
                  <input
                    type="number"
                    step="0.01"
                    class="form-control"
                    id="MACD"
                    name="MACD"
                    placeholder="e.g., 150.25"
                  />
                  <div class="form-text">
                    Moving Average Convergence Divergence
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="MACD_Signal" class="form-label"
                    >MACD Signal:</label
                  >
                  <input
                    type="number"
                    step="0.01"
                    class="form-control"
                    id="MACD_Signal"
                    name="MACD_Signal"
                    placeholder="e.g., 140.50"
                  />
                  <div class="form-text">MACD Signal line</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-header">
              <h5><i class="fas fa-info-circle"></i> Normalization Ranges</h5>
            </div>
            <div class="card-body">
              <p class="text-muted mb-3">
                Values are normalized to the [{{ norm_min }}, {{ norm_max }}]
                range:
              </p>
              <div class="table-responsive">
                <table class="table table-sm table-hover">
                  <thead>
                    <tr>
                      <th>Feature</th>
                      <th>Min Value</th>
                      <th>Max Value</th>
                      <th>Normalized to</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for feature in features %}
                    <tr>
                      <td><strong>{{ feature }}</strong></td>
                      <td>
                        {% if norm_ranges and feature in norm_ranges %} {{
                        norm_ranges[feature][0] }} {% else %} N/A {% endif %}
                      </td>
                      <td>
                        {% if norm_ranges and feature in norm_ranges %} {{
                        norm_ranges[feature][1] }} {% else %} N/A {% endif %}
                      </td>
                      <td>[{{ norm_min }}, {{ norm_max }}]</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="d-grid gap-2 d-md-flex justify-content-md-center">
            <button
              type="submit"
              class="btn btn-primary btn-lg me-md-3"
              id="predictBtn"
            >
              <i class="fas fa-crystal-ball"></i> Predict Tomorrow's Price
            </button>
            <button
              type="button"
              class="btn btn-outline-success me-md-3"
              onclick="fillSampleData('BTC')"
            >
              <i class="fab fa-bitcoin"></i> BTC Sample
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary"
              onclick="clearForm()"
            >
              <i class="fas fa-eraser"></i> Clear Form
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  function fillSampleData(crypto) {
    const sampleData = {
      BTC: {
        Open: 42000.5,
        High: 42500.75,
        Low: 41800.25,
        Close: 42200.0,
        Daily_Return: -0.48,
        RSI: 65.5,
        Volatility_7: 0.025,
        MA_7: 42150.0,
        MACD: 150.25,
        MACD_Signal: 145.75,
      },
      ETH: {
        Open: 2250.3,
        High: 2280.5,
        Low: 2235.75,
        Close: 2260.25,
        Daily_Return: 0.44,
        RSI: 58.3,
        Volatility_7: 0.028,
        MA_7: 2245.0,
        MACD: 25.8,
        MACD_Signal: 24.5,
      },
      LTC: {
        Open: 75.6,
        High: 76.8,
        Low: 74.9,
        Close: 75.75,
        Daily_Return: 0.2,
        RSI: 52.1,
        Volatility_7: 0.032,
        MA_7: 75.2,
        MACD: 1.25,
        MACD_Signal: 1.15,
      },
      XPR: {
        Open: 0.52,
        High: 0.54,
        Low: 0.51,
        Close: 0.53,
        Daily_Return: 1.92,
        RSI: 62.8,
        Volatility_7: 0.035,
        MA_7: 0.525,
        MACD: 0.025,
        MACD_Signal: 0.02,
      },
    };

    // Fill the form with sample data
    const data = sampleData[crypto];
    for (const [key, value] of Object.entries(data)) {
      const input = document.getElementById(key);
      if (input) {
        input.value = value;
      }
    }

    // Select the cryptocurrency
    document.getElementById("cryptocurrency").value = crypto;

    // Auto-calculate Daily_Return if not already filled
    autoCalculateDailyReturn();
  }

  function autoCalculateDailyReturn() {
    const openInput = document.getElementById("Open");
    const closeInput = document.getElementById("Close");
    const dailyReturnInput = document.getElementById("Daily_Return");

    if (openInput && closeInput && dailyReturnInput) {
      const open = parseFloat(openInput.value);
      const close = parseFloat(closeInput.value);
      const currentDailyReturn = parseFloat(dailyReturnInput.value);

      // Only calculate if both values exist and Daily_Return is empty
      if (open && close && !currentDailyReturn) {
        const dailyReturn = (((close - open) / open) * 100).toFixed(2);
        dailyReturnInput.value = dailyReturn;
      }
    }
  }

  function clearForm() {
    document.getElementById("predictionForm").reset();
    document.getElementById("cryptocurrency").value = "";
  }

  // Auto-calculate Daily Return when Open or Close changes
  document
    .getElementById("Open")
    ?.addEventListener("change", autoCalculateDailyReturn);
  document
    .getElementById("Close")
    ?.addEventListener("change", autoCalculateDailyReturn);

  // Add loading animation on form submission
  document
    .getElementById("predictionForm")
    ?.addEventListener("submit", function () {
      const submitBtn = document.getElementById("predictBtn");
      if (submitBtn) {
        submitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Predicting...';
        submitBtn.disabled = true;
      }
    });
</script>
{% endblock %}
